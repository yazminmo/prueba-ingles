<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Nivel de Inglés</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #e6f3ff;
        }
        h1, h2 {
            color: #006699;
        }
        .test-section {
            background-color: #ffffff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 12px 20px;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            background-color: #f8f8f8;
            resize: none;
        }
        #timer {
            font-size: 24px;
            color: #006699;
            text-align: center;
            margin-bottom: 20px;
        }
        .hidden {
            display: none;
        }
        .question {
            margin-bottom: 15px;
        }
        .options {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <h1>Prueba de Nivel de Inglés</h1>
    
    <div class="test-section" id="writing-test">
        <!-- El contenido de la Prueba 1: Escritura permanece sin cambios -->
    </div>

    <div class="test-section hidden" id="listening-test">
        <h2>Prueba 2: Escucha</h2>
        <p>Tema: <span id="listening-topic"></span></p>
        <audio id="audio-player" controls>
            <source src="" type="audio/mpeg">
            Tu navegador no soporta el elemento de audio.
        </audio>
        <p>Reproducciones restantes: <span id="plays-left">2</span></p>
        <div id="listening-timer">Tiempo restante: 5:00</div>
        <div id="questions-container"></div>
        <button id="start-listening" onclick="startListeningTest()">Comenzar prueba</button>
        <button id="submit-listening" onclick="submitListening()" class="hidden">Enviar respuestas</button>
    </div>

    <div class="test-section hidden" id="speaking-test">
        <h2>Prueba 3: Conversación</h2>
        <!-- Contenido de la prueba de conversación -->
    </div>

    <div class="test-section hidden" id="results">
        <h2>Prueba 4: Resultados</h2>
        <!-- Contenido de los resultados -->
    </div>

    <script>
        // El código de la Prueba 1: Escritura permanece sin cambios

        // Configuración para la Prueba 2: Escucha
        const listeningTopics = [
            "Una conversación sobre planes de viaje",
            "Discusión sobre hábitos alimenticios saludables",
            "Debate sobre el impacto de la tecnología en la educación"
        ];
        const listeningTimeLimit = 5 * 60; // 5 minutos en segundos
        const maxPlays = 2;
        let currentListeningTopic = '';
        let listeningTimer;
        let remainingListeningTime = listeningTimeLimit;
        let playsLeft = maxPlays;
        let currentQuestions = [];

        function startListeningTest() {
            document.getElementById('start-listening').classList.add('hidden');
            document.getElementById('submit-listening').classList.remove('hidden');
            currentListeningTopic = listeningTopics[Math.floor(Math.random() * listeningTopics.length)];
            document.getElementById('listening-topic').textContent = currentListeningTopic;
            
            // En un escenario real, aquí se cargaría el audio correspondiente al tema
            document.getElementById('audio-player').src = "path_to_audio_file.mp3";
            
            generateQuestions();
            startListeningTimer();
            
            document.getElementById('audio-player').addEventListener('play', function() {
                if (playsLeft > 0) {
                    playsLeft--;
                    document.getElementById('plays-left').textContent = playsLeft;
                }
                if (playsLeft === 0) {
                    this.addEventListener('ended', function() {
                        this.disabled = true;
                    });
                }
            });
        }

        function generateQuestions() {
            // En un escenario real, estas preguntas se generarían basadas en el contenido del audio
            const questions = [
                {
                    question: "¿Cuál es el tema principal de la conversación?",
                    options: ["Opción A", "Opción B", "Opción C", "Opción D"]
                },
                {
                    question: "¿Qué opinión expresó el primer hablante?",
                    options: ["Opción A", "Opción B", "Opción C", "Opción D"]
                },
                {
                    question: "¿Cuál fue la conclusión de la discusión?",
                    options: ["Opción A", "Opción B", "Opción C", "Opción D"]
                }
            ];

            const container = document.getElementById('questions-container');
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <p>${index + 1}. ${q.question}</p>
                    <div class="options">
                        ${q.options.map((option, i) => `
                            <div>
                                <input type="radio" id="q${index}o${i}" name="q${index}" value="${option}">
                                <label for="q${index}o${i}">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(questionDiv);
            });

            currentQuestions = questions;
        }

        function startListeningTimer() {
            listeningTimer = setInterval(() => {
                remainingListeningTime--;
                const minutes = Math.floor(remainingListeningTime / 60);
                const seconds = remainingListeningTime % 60;
                document.getElementById('listening-timer').textContent = `Tiempo restante: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                if (remainingListeningTime <= 0) {
                    clearInterval(listeningTimer);
                    submitListening();
                }
            }, 1000);
        }

        function submitListening() {
            clearInterval(listeningTimer);
            document.getElementById('audio-player').disabled = true;
            document.getElementById('submit-listening').classList.add('hidden');
            
            // Aquí iría la lógica de evaluación automática
            const feedback = evaluateListening();
            alert(feedback);

            // Activar la siguiente prueba
            document.getElementById('speaking-test').classList.remove('hidden');
        }

        function evaluateListening() {
            // Esta es una función de evaluación muy básica
            const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
            let feedback = `Has respondido ${answeredQuestions} de ${currentQuestions.length} preguntas. `;
            
            if (answeredQuestions === currentQuestions.length) {
                feedback += "Has completado todas las preguntas. Buen trabajo!";
            } else {
                feedback += "Asegúrate de responder todas las preguntas la próxima vez.";
            }

            return feedback;
        }
    </script>
</body>
</html>
